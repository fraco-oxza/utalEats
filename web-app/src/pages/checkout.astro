---
import Layout from "../layouts/Layout.astro";
import NavBar from "../components/NavBar.astro";
import CartContainer from "../components/CartContainer";
import Stars from "../components/Stars.astro";
import Comment from "../components/Comment.astro";

let username;
let city: string;

const userIdCookie = Astro.cookies.get("user-id");
if (userIdCookie) {
    const url = "http://identity:3000/profile/?accountId=" + userIdCookie.value;
    const response = await fetch(url);
    if (response.ok) {
        const data = await response.json();
        username = data.name.split(" ")[0];
        city = data.city;
    } else {
        Astro.cookies.delete("user-id");
        return Astro.redirect("/login");
    }
} else {
    return Astro.redirect("/login");
}
---

<Layout title="UtalEats">
    <main>
        <NavBar username={username} city={city} />
        <div class="page">
            <div class="orders">
                <h1>Order details</h1>
                <CartContainer client:load></CartContainer>
            </div>
            <div class="rating">
                <div>
                    <h1>Rate the store</h1>
                    <Stars></Stars>
                </div>
                <div class="review">
                    <h1>Leave a review</h1>
                    <Comment></Comment>
                </div>
            </div>
        </div>
    </main>
</Layout>
<style>
    main {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    .page {
        display: flex;
        justify-content: center;
        gap: 40px;
    }

    .rating {
        display: flex;
        flex-direction: column;
        gap: 20px;
        width: 100%;
    }

    .review {
        width: 100%;
    }
</style>